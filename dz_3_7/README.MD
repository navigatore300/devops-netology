#Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"
1. Проверьте список доступных сетевых интерфейсов на вашем компьютере.  
Какие команды есть для этого в Linux и в Windows?

_Ответ:_  

Linux  
```
ip -br link show

lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
enp1s8           UP             00:1e:33:e5:7b:4f <BROADCAST,MULTICAST,UP,LOWER_UP>
wlp2s0           DOWN           c0:f8:da:7a:e7:ae <BROADCAST,MULTICAST>
```

Windows
```
netsh interface show interface

Состояние адм.  Состояние     Тип              Имя интерфейса
---------------------------------------------------------------------
Разрешен       Подключен      Выделенный       VBox Host-Only Network 56
Разрешен       Подключен      Выделенный       vboxnet0
Разрешен       Подключен      Выделенный       Ethernet
Разрешен       Отключен       Выделенный       Ethernet 2
```

---

2. Какой протокол используется для распознавания соседа по сетевому интерфейсу?  
Какой пакет и команды есть в Linux для этого?

_Ответ:_

Протокол LLDP, открытая альтернатива проприетарному протоколу CDP от Cisco.

Пакет lldpd.

Командой lldpctl можно посмотреть соседей. 

```commandline
root@home-d10:~# ip -br link show
lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
enp1s8           UP             00:1e:33:e5:7b:4f <BROADCAST,MULTICAST,UP,LOWER_UP>
wlp2s0           DOWN           c0:f8:da:7a:e7:ae <BROADCAST,MULTICAST>
root@home-d10:~# lldpctl
-------------------------------------------------------------------------------
LLDP neighbors:
-------------------------------------------------------------------------------
Interface:    enp1s8, via: LLDP, RID: 1, Time: 0 day, 00:09:45
  Chassis:
    ChassisID:    mac 00:c0:df:06:25:b5
    SysName:      deb10.local.maximden.ru
    SysDescr:     Debian GNU/Linux 10 (buster) Linux 4.19.0-17-amd64 #1 SMP Debian 4.19.194-3 (2021-07-18) x86_64
    MgmtIP:       192.168.100.10
    MgmtIP:       fe80::f66d:4ff:fe1c:6e67
    Capability:   Bridge, off
    Capability:   Router, on
    Capability:   Wlan, off
    Capability:   Station, off
  Port:
    PortID:       mac f4:6d:04:1c:6e:67
    PortDescr:    enp1s0
    TTL:          120
    PMD autoneg:  supported: yes, enabled: yes
      MAU oper type: 1000BaseTFD - Four-pair Category 5 UTP, full duplex mode
-------------------------------------------------------------------------------
Interface:    enp1s8, via: LLDP, RID: 2, Time: 0 day, 00:01:45
  Chassis:
    ChassisID:    mac 90:f6:52:04:bc:a9
  Port:
    PortID:       mac 90:f6:52:04:bc:a9
    TTL:          3601
    PMD autoneg:  supported: yes, enabled: yes
      Adv:          1000Base-T, HD: no, FD: yes
      MAU oper type: unknown
  LLDP-MED:
    Device Type:  Generic Endpoint (Class I)
    Capability:   Capabilities, yes
-------------------------------------------------------------------------------
```

---

3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей?  
Какой пакет и команды есть в Linux для этого?  
Приведите пример конфига.

_Ответ:_

Эта технология называется VLAN(Virtual Local Area Network).  
Пакет для работы с VLAN называется vlan. Его можно установить командой `apt-get install vlan`  
Для настройки интерфейсов можно использовать команду `vconfig`, но в настоящее время рекомендуется использовать утилиту `ip`, либо вносить настройки в файл конфигурации интерфейсов.

Пример создания интерфейса для VLAN ID = 200
+ vocnfig  

```
vconfig add enp1s8 200
ifconfig enp1s8.200 192.168.200.200 netmask 255.255.255.0 broadcast 192.168.200.255 up
```
+ ip

```
ip link add link enp1s8 name enp1s8.200 type vlan id 200
ip addr add 192.168.200.200/24 brd 192.168.200.255 dev enp1s8.200
ip link set dev enp1s8.200 up
```

+ /etc/network/interfaces

```
auto enp1s8.200
iface enp1s8.200 inet static
address 192.168.200.200
netmask 255.255.255.0
vlan-raw-device enp1s8
```

---

4. Какие типы агрегации интерфейсов есть в Linux?  
Какие опции есть для балансировки нагрузки?  
Приведите пример конфига.

_Ответ:_

Типы агрегации интерфейсов в Linux
Bonding – это объединение сетевых интерфейсов по определенному типу агрегации, Служит для увеличения пропускной способности и/или отказоустойчивость сети.

Типы агрегации интерфейсов в Linux:

Mode-0(balance-rr) – Данный режим используется по умолчанию. Balance-rr обеспечивается балансировку нагрузки и отказоустойчивость. В данном режиме сетевые пакеты отправляются “по кругу”, от первого интерфейса к последнему. Если выходят из строя интерфейсы, пакеты отправляются на остальные оставшиеся. Дополнительной настройки коммутатора не требуется при нахождении портов в одном коммутаторе. При разностных коммутаторах требуется дополнительная настройка.

Mode-1(active-backup) – Один из интерфейсов работает в активном режиме, остальные в ожидающем. При обнаружении проблемы на активном интерфейсе производится переключение на ожидающий интерфейс. Не требуется поддержки от коммутатора.

Mode-2(balance-xor) – Передача пакетов распределяется по типу входящего и исходящего трафика по формуле ((MAC src) XOR (MAC dest)) % число интерфейсов. Режим дает балансировку нагрузки и отказоустойчивость. Не требуется дополнительной настройки коммутатора/коммутаторов.

Mode-3(broadcast) – Происходит передача во все объединенные интерфейсы, тем самым обеспечивая отказоустойчивость. Рекомендуется только для использования MULTICAST трафика.

Mode-4(802.3ad) – динамическое объединение одинаковых портов. В данном режиме можно значительно увеличить пропускную способность входящего так и исходящего трафика. Для данного режима необходима поддержка и настройка коммутатора/коммутаторов.

Mode-5(balance-tlb) – Адаптивная балансировки нагрузки трафика. Входящий трафик получается только активным интерфейсом, исходящий распределяется в зависимости от текущей загрузки канала каждого интерфейса. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.

Mode-6(balance-alb) – Адаптивная балансировка нагрузки. Отличается более совершенным алгоритмом балансировки нагрузки чем Mode-5). Обеспечивается балансировку нагрузки как исходящего так и входящего трафика. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.

```commandline
auto bond0
iface bond0 inet static
    address 192.168.1.150
    netmask 255.255.255.0    
    gateway 192.168.1.1
    dns-nameservers 192.168.1.1 8.8.8.8
    dns-search domain.local
        slaves eth0 eth1
        bond_mode 0
        bond-miimon 100
        bond_downdelay 200
        bound_updelay 200
```
---

5. Сколько IP адресов в сети с маской /29 ?  
Сколько /29 подсетей можно получить из сети с маской /24.  
Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

_Ответ:_

В сети с маской /29 всего 8 адресов если вычесть 1 под адрес сети и один под широковещательный адрес то получается, что использовать можно только 6.  
Так как сеть с маской /24 имеет 256 адресов, то 256/8 = 32. /24 можно разбить на 32 сети /29.  
В сети 10.10.10.0 изменяется только последний октет. Следовательно, 10.10.10 сохраняется и взяв любое число от 0 до 31 умножив на 8 получим искомую сеть:  

число 3: 8 * 3=24: `10.10.10.24/29`  
число 12: 12 * 8=96 `10.10.10.96/29`  
число 20: 20 * 8=160 `10.10.10.160/29`  
---

6. Задача: вас попросили организовать стык между 2-мя организациями.  
Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты.  
Из какой подсети допустимо взять частные IP адреса?  
Маску выберите из расчета максимум 40-50 хостов внутри подсети.

_Ответ:_

Получается что все обычно используемы частные сети заняты и остается использовать только:  
100.64.0.0 — 100.127.255.255 (маска подсети 255.192.0.0 или /10) — Данная подсеть рекомендована согласно RFC 6598 для использования в качестве адресов для CGN (Carrier-Grade NAT).  
Учитывая условия 40-50 хостов ближайшее 2 в степени n = 64, то есть маска /26

Например 100.100.100.0/26

---

7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

_Ответ:_

Просмотреть таблицу можно так:

Linux: ip neigh, ip n 
Windows: arp -a

Очистить кеш так:

Linux: ip neigh flush
Windows: arp -d *

Удалить один IP так:

Linux: ip neigh delete <IP> dev <INTERFACE>, ip neigh flush dev eth0
Windows: arp -d <IP>

---

Задание для самостоятельной отработки (необязательно к выполнению)
8. Установите эмулятор EVE-ng.  
Инструкция по установке - https://github.com/svmyasnikov/eve-ng  
Выполните задания на lldp, vlan, bonding в эмуляторе EVE-ng.

_Ответ:_



---
